---
title: "2026年、Zigがアツい"
date: 2026-01-15
tags: ["Zig", "distributed-systems", "DST"]
description: "ZigのI/O注入機構と分散システムのDeterministic Simulation Testingへの期待、そして個人的な学習計画について"
---

2026年、個人的にZigへの期待が高まっている。

きっかけはZigの新しいI/O周りの仕組みを知ったことだった。この仕組みが、分散システムのテストにおいて長年の課題だった「決定的なシミュレーションテスト」を実現する鍵になるのではないかと感じている。

この記事では、ZigのI/O注入の仕組み、それが分散システムのテストにどう活きるか、そして自分の学習計画についてまとめる。

## ZigのI/O注入機構

Zigは最近、I/O操作を抽象化し、任意の実装を注入できる仕組みを導入した。これは単なるDI（依存性注入）の話ではなく、言語レベルでasyncの振る舞いを差し替え可能にするという設計思想に基づいている。

従来の多くの言語では、非同期ランタイムは言語やフレームワークに深く組み込まれている。例えばRustのtokioを使う場合、tokioランタイムの振る舞いがアプリケーション全体に浸透する。

一方Zigでは、I/O操作がランタイムから分離されており、コンパイル時に異なる実装を注入できる。これにより：

- 本番環境では高性能な非同期ランタイムを使用
- テスト時にはシミュレーション用のランタイムを注入

といった使い分けが、アプリケーションコードを変更することなく可能になる。

## 分散システムのテストへの期待

### Deterministic Simulation Testing（DST）とは

分散システムのテストは非常に難しい。ネットワーク遅延、パケットロス、ノード障害など、現実世界で起こりうるあらゆる状況を再現してテストする必要があるが、これらは本質的に非決定的（non-deterministic）だ。

Deterministic Simulation Testing（DST）は、この問題に対する解決策の一つ。分散システムの全ての状態遷移をシミュレーション上で再現し、決定的に実行することで、バグの再現性を確保する手法だ。

DSTの大きな利点は、一度バグを発見したら、そのバグに至るまでの状態遷移とイベントの順番を完全に特定できること。同じシード値でシミュレーションを実行すれば、常に同じバグを再現できる。

### Georgia TechのDSLabでの経験

Georgia Techの大学院で履修した分散システムの授業では、まさにこのDSTを活用したテストの仕組みが用意されていた。

そこでは、分散システムの状態遷移を木構造として捉え、枝刈りをしながら可能な限り状態空間を探索し、不変条件（invariant）が常に満たされているかを検証するというアプローチを取っていた。

このフレームワークのおかげで、自分が実装したRaftやPaxosのバグを効率的に発見でき、再現性のあるテストケースとして残すことができた。DSTの威力を実感した経験だった。

### Rustのtokioでは難しい理由

RustでDSTを実現しようという試みは存在する。[turmoil](https://github.com/tokio-rs/turmoil)というtokio-rsの実験的プロジェクトがそれだ。

しかしturmoilには多くの制約がある。tokioランタイムが深くアプリケーションに組み込まれているため、シミュレーション用のランタイムに差し替えるには、多くの制限を受け入れる必要がある。結果として、現実的なプロダクションコードに対してturmoilを適用するのは難しい場合が多い。

### Zigなら解決できるかもしれない

ここでZigのI/O注入機構が活きてくる。

Zigの設計であれば：

1. 本番ビルドでは高性能な非同期ランタイムを使用
2. DSTを行いたいときはテスト用のシミュレーションランタイムを注入

という切り替えが、同一のアプリケーションコードに対して自然に行えるはずだ。

これは分散システムを開発する上で非常に魅力的な特性だと考えている。TigerBeetleがZigを採用している理由の一つもここにあるのではないかと推測している。

## 具体的な学習計画

期待だけでは何も始まらないので、実際にZigを学び始めている。

### Codecraftersでシェル自作

まずは手を動かすことから。[Codecrafters](https://codecrafters.io)で今月無料になっているシェルの自作課題をZigでやっている。

システムコールを直接扱う題材なので、Zigの低レイヤーな特性を学ぶのにちょうど良い。プロセスのfork/exec、パイプ、リダイレクトなど、普段当たり前に使っているシェルの仕組みを理解するのも楽しい。

### 2022年夏の心残り

実はZigとの付き合いは今回が初めてではない。

2022年の夏、[時雨堂](https://shiguredo.jp/)さんのサマーインターンに参加し、ZigでQUICサーバーを実装するというプロジェクトに取り組んだ。しかし、期間内に疎通するところまでたどり着けず、ずっと心残りだった。

今ならAIの力を借りながら、4年前の挫折を乗り越えられるのではないかという期待がある。

余談だが、AIはネットワークプロトコルの実装がかなり得意だと感じている。RFCで仕様がかっちり決まっていて、様々な言語での実装が既に存在し、相互運用性を担保するためのテストスイートが充実しているようなドメインは、AIが力を発揮しやすい領域だと思う。

### その他やってみたいこと

他にも気になっていることがいくつかある：

- **TCP/IP自作本をZigで**: [『作って理解するTCP/IP』](https://www.sbcr.jp/product/4797388909/)のような本をZigでやってみるのも面白そう
- **ハイパーバイザー自作**: 仕事でハイパーバイザー周りを触ることもあるので、[『自作エミュレータで学ぶx86アーキテクチャ』](https://book.mynavi.jp/ec/products/detail/id=115920)のような本をZigでやるのも気になる（Zennに既にやっている方がいらっしゃる）

低レイヤーを学ぶのにZigは適していると思うので、色々試してみたい。

## Zigの採用事例と将来性

Zigは既に大きなプロジェクトで採用されている：

- **[Bun](https://bun.sh/)**: 高速なJavaScriptランタイム。ZigでNode.js互換のランタイムを実装し、圧倒的なパフォーマンスを実現している
- **[Ghostty](https://ghostty.org/)**: Mitchell Hashimoto氏が開発しているターミナルエミュレータ。GPUアクセラレーションを活用した高速な描画を実現
- **[TigerBeetle](https://tigerbeetle.com/)**: 金融向けの分散データベース。まさにDSTを活用した開発を行っており、Zigの設計思想とマッチしている

これらのプロジェクトが示すように、Zigはパフォーマンスが重要な領域、特に低レイヤーなシステムソフトウェアの開発において存在感を増している。

## まとめ

2026年、Zigに注目している理由をまとめると：

1. **I/O注入機構**: ランタイムの振る舞いを差し替え可能な設計が、分散システムのDSTと相性が良い
2. **実績**: Bun、Ghostty、TigerBeetleなど、大規模プロジェクトでの採用実績
3. **個人的な心残り**: 2022年のインターンでの挫折を乗り越えたい

低レイヤーの知識を深めながら、Zigを通じて分散システムのテスタビリティについても探求していきたいと思っている。
